{"version":3,"file":"purchaseService-Ch7OkBNR.js","sources":["../../services/purchaseService.ts"],"sourcesContent":["// services/purchaseService.ts\n// Servicio minimal para compras in-app usando cordova-plugin-purchase (window.store)\n\ntype StoreAny = any;\n\nconst isStoreAvailable = (): boolean => typeof (globalThis as any).store !== 'undefined';\n\nexport const initPurchases = (productIds: string[]) => {\n  if (!isStoreAvailable()) {\n    console.warn('In-app purchase plugin no disponible (web).');\n    return;\n  }\n  const store: StoreAny = (globalThis as any).store;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (store as any).verbosity = (store as any).DEBUG;\n\n  productIds.forEach(id => {\n    (store as any).register({\n      id,\n      type: (store as any).CONSUMABLE // cambiar segÃºn producto (CONSUMABLE | NON_CONSUMABLE | SUBSCRIPTION)\n    });\n  });\n\n  (store as any).when('ready').then(() => {\n    console.log('Store ready, productos:', (store as any).products);\n  }).catch((err: any) => console.warn('Store ready error', err));\n\n  (store as any).refresh();\n};\n\nexport const buyProduct = (productId: string): Promise<any> => {\n  return new Promise((resolve, reject) => {\n    if (!isStoreAvailable()) return reject(new Error('Plugin de compras no disponible'));\n    const store: StoreAny = (globalThis as any).store;\n\n    (store as any).order(productId).then((purchase: any) => {\n      console.log('Compra finalizada', purchase);\n      resolve(purchase);\n    }).catch((err: any) => {\n      console.error('Error compra', err);\n      reject(err);\n    });\n  });\n};\n\nexport const restorePurchases = (): Promise<any> => {\n  return new Promise((resolve, reject) => {\n    if (!isStoreAvailable()) return reject(new Error('Plugin de compras no disponible'));\n    const store: StoreAny = (globalThis as any).store;\n    (store as any).refresh();\n    (store as any).when('ready').then(() => resolve((store as any).products)).catch(reject);\n  });\n};\n"],"names":["isStoreAvailable","initPurchases","productIds","store","id","err","buyProduct","productId","resolve","reject","purchase","restorePurchases"],"mappings":"AAKA,MAAMA,EAAmB,IAAe,OAAQ,WAAmB,MAAU,IAEhEC,EAAiBC,GAAyB,CACrD,GAAI,CAACF,IAAoB,CACvB,QAAQ,KAAK,6CAA6C,EAC1D,MACF,CACA,MAAMG,EAAmB,WAAmB,MAE3CA,EAAc,UAAaA,EAAc,MAE1CD,EAAW,QAAQE,GAAM,CACtBD,EAAc,SAAS,CACtB,GAAAC,EACA,KAAOD,EAAc,UAAA,CACtB,CACH,CAAC,EAEAA,EAAc,KAAK,OAAO,EAAE,KAAK,IAAM,CACtC,QAAQ,IAAI,0BAA4BA,EAAc,QAAQ,CAChE,CAAC,EAAE,MAAOE,GAAa,QAAQ,KAAK,oBAAqBA,CAAG,CAAC,EAE5DF,EAAc,QAAA,CACjB,EAEaG,EAAcC,GAClB,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,GAAI,CAACT,IAAoB,OAAOS,EAAO,IAAI,MAAM,iCAAiC,CAAC,EAC1D,WAAmB,MAE7B,MAAMF,CAAS,EAAE,KAAMG,GAAkB,CACtD,QAAQ,IAAI,oBAAqBA,CAAQ,EACzCF,EAAQE,CAAQ,CAClB,CAAC,EAAE,MAAOL,GAAa,CACrB,QAAQ,MAAM,eAAgBA,CAAG,EACjCI,EAAOJ,CAAG,CACZ,CAAC,CACH,CAAC,EAGUM,EAAmB,IACvB,IAAI,QAAQ,CAACH,EAASC,IAAW,CACtC,GAAI,CAACT,IAAoB,OAAOS,EAAO,IAAI,MAAM,iCAAiC,CAAC,EACnF,MAAMN,EAAmB,WAAmB,MAC3CA,EAAc,QAAA,EACdA,EAAc,KAAK,OAAO,EAAE,KAAK,IAAMK,EAASL,EAAc,QAAQ,CAAC,EAAE,MAAMM,CAAM,CACxF,CAAC"}